---
title: "Interactive Maps with Leaflet"
subtitle: "Using Leaflet: A Tutorial"
author: "Franco Bastida and Elena Murray"
date: "`r format(Sys.time(), '%B %d, %Y | %H:%M:%S | %Z')`"
output:
  html_document:
    code_folding: show
    df_print: paged
    highlight: tango
    number_sections: no
    theme: cosmo
    toc: no
---

```{=html}
<style>
div.answer {background-color:#f3f0ff; border-radius: 5px; padding: 20px;}
</style>
```
```{r, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,
                      eval = TRUE,
                      error = FALSE,
                      message = FALSE,
                      warning = FALSE,
                      comment = NA)
```

First, install the packages that we need to use.

```{r, include = T}
library(htmlwidgets)
library(leaflet)
library(tidyverse)
library(sf)
```

<h2><strong>Getting Started</strong></h2>

<h4><strong>Setting up a base map</strong></h4>

-   `addTiles()` add your base map layer using OpenStreetMap

-   `addMarkers()` pinpoint a point of interest on the map

Let's start by adding the base tiles of the map, and adding one marker for a point of interest. You can find the coordinates to many points of interest on the [Open Street Map Website](https://www.openstreetmap.org/). 

```{r}
m <- leaflet() %>%
  addTiles() %>%  # Add default OpenStreetMap map tiles
  addMarkers(lng=1, lat=1, popup="Add your text here") #Add your desired coordinates and message for the pop-up. 
m  # Print the map
```

<h4><strong>Changing the Bse Map</strong></h4>

As mentioned in the presentation, OpenStreetMap is not the only base of tiles that can be used. Many other popular free third-party basemaps can be added using the addProviderTiles() function, which is implemented using the leaflet-providers plugin. You can find the full list of options [here](https://leaflet-extras.github.io/leaflet-providers/preview/index.html). 

As a convenience, leaflet also provides a named list of all the third-party tile providers that are supported by the plugin. This enables you to use auto-completion feature of your favorite R IDE (like RStudio) and not have to remember or look up supported tile providers; just type providers$ and choose from one of the options. You can also use names(providers) to view all of the options.

Let's try using some different examples:

```{r}
#Using a NatGeo Map
m %>% addProviderTiles(providers$Esri.NatGeoWorldMap)

#Using a Watercolour Map
m %>% addProviderTiles(providers$Stadia.StamenWatercolor)

#Select another of the options from the link above and try it here:


```

<h4><strong>Adding Data</strong></h4>




Now, we import the data sets that we are going to use. The deforestation data was collected by the [Global Forest Watch](https://www.globalforestwatch.org/) and the specific data for Colombia can be found [here](https://gfw.global/478KQ1A). The geographic files for the municipalities of Colombia are shared by [Laboratorio Urbano - Bogotá](https://bogota-laburbano.opendatasoft.com/pages/home/) and they can be accessed [here](https://bogota-laburbano.opendatasoft.com/explore/dataset/shapes/export/?location=6,4.85836,-73.2019&basemap=jawg.streets). Although, the files come in different formats, we decided to used the `Shapefile` format for this exercise.

```{r}
#Load the GeoJSON data file
data_map <- read_sf("leaflet_tutorial_files/data/christmas_markets.geojson")


```

Since we are working with data from Colombia, some of the municipalities for the "deforestation" data set include the accent. Thus, we use the `stri_trans_general()` function from the package `stringi`. However, since the Spanish language also uses the Ñ and the Ü, we do not want of get rid of those. Therefore, we need to create a function:

-   custom `function()`

-   `sapply()` apply a function on a vector (i.e. column)

```{r, include = T}
#Read your code here
```

<h4><strong>Merging Data sets</strong></h4>

After cleaning the data, we need to merge the different files. There are 91 municipalities with no data available in the deforestation data set.

-   `full_join()` join every field including non-matches

-   `anti-join()` find every field that does not match

```{r, include = T}
#Read your code here
```

<h4><strong>Getting creative with the map</strong></h4>

Now that we have the data needed for our map, we can create a palette of colors and some tags.

-   `leaflet()` function to use leaflet

-   `addTiles()` adds base map to your map

    -   `addProviderTiles()` gets third party tiles

    -   `addProviderTiles(providers$Stadia.AlidadeSmooth)` an example of a third party base map

-   `addPolygons()`

-   `names(providers)` search available base maps

```{r, include = T}
#Read your code here
```
